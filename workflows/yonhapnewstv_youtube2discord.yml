name: Send a Discord message when new Youtube videos update
on:
  youtube:
    channel_id:
      - UCTHCOPwqNfZ0uiKOvFyhGwg
    config:
      filter:
        title:
          $regex: "ÎÇ†Ïî®"
jobs:
  discord:
    name: Send a message to discord
    runs-on: ubuntu-latest
    steps:
      - name: Prepare message
        id: prepare
        run: |
          TITLE="${{on.youtube.outputs.title}}"
          ESCAPED_TITLE=$(echo "$TITLE" | sed 's/\\/\\\\/g' | sed 's/"/ÔºÇ/g' | sed "s/'/Ôºá/g" | sed 's/\$/ÔºÑ/g' | sed 's/`/Ôºá/g' | sed 's/|/ÔΩú/g' | sed 's/\?/Ôºü/g' | sed 's/\*/Ôºä/g' | sed 's/+/Ôºã/g' | sed 's/(/Ôºà/g' | sed 's/)/Ôºâ/g' | sed 's/{/ÔΩõ/g' | sed 's/}/ÔΩù/g' | sed 's/\[/Ôºª/g' | sed 's/\]/ÔºΩ/g' | sed 's/;/Ôºõ/g' | sed 's/&/ÔºÜ/g' | sed 's/\^/Ôºæ/g' | sed 's/%/ÔºÖ/g' | sed 's/#/ÔºÉ/g' | sed 's/@/Ôº†/g' | sed 's/!/ÔºÅ/g' | sed 's/</Ôºú/g' | sed 's/>/Ôºû/g' | sed 's/~/ÔΩû/g')
          echo "Escaped title: $ESCAPED_TITLE"
          echo "::set-output name=escaped_title::$ESCAPED_TITLE"
      - name: Discord notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          DISCORD_USERNAME: ${{ secrets.DISCORD_USERNAME_YONHAP }}
          DISCORD_AVATAR: ${{ secrets.DISCORD_AVATAR_YONHAP }}
        uses: Ilshidur/action-discord@master
        with:
          args: "`Ïó∞Ìï©Îâ¥Ïä§TV - YouTube`'\n'**${{steps.prepare.outputs.escaped_title}}**'\n'${{on.youtube.outputs.link}}'\n\n'üìÖ ${{on.youtube.outputs.pubDate}}"

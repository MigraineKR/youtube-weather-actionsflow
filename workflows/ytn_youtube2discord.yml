name: Send a Discord message when new Youtube videos update
on:
  youtube:
    channel_id:
      - UChlgI3UHCOnwUGzWzbJ3H5w
    config:
      filter:
        title:
          $regex: "[ë‚ ì”¨]"
jobs:
  discord:
    name: Send a message to discord
    runs-on: ubuntu-latest
    steps:
      - name: Prepare message
        id: prepare
        run: |
          TITLE="${{on.youtube.outputs.title}}"
          echo "Original title: $TITLE"
          ESCAPED_TITLE=$(echo "$TITLE" | sed 's/\\/\\\\/g' | sed 's/"/\\"/g' | sed "s/'/\\\'/g" | sed 's/\$/\\$/g' | sed 's/`/\\`/g' | sed 's/|/\\|/g' | sed 's/\?/\\?/g' | sed 's/\*/\\*/g' | sed 's/+/\\+/g' | sed 's/(/\\(/g' | sed 's/)/\\)/g' | sed 's/{/\\{/g' | sed 's/}/\\}/g' | sed 's/\[/\\[/g' | sed 's/\]/\\]/g' | sed 's/;/\\;/g' | sed 's/&/\\&/g' | sed 's/\^/\\^/g' | sed 's/%/\\%/g' | sed 's/#/\\#/g' | sed 's/@/\\@/g' | sed 's/!/\\!/g' | sed 's/</\\</g' | sed 's/>/\\>/g' | sed 's/~/\\~/g')
          echo "Escaped title: $ESCAPED_TITLE"
          echo "::set-output name=escaped_title::$ESCAPED_TITLE"
      - name: Discord notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          DISCORD_USERNAME: ${{ secrets.DISCORD_USERNAME_YTN }}
          DISCORD_AVATAR: ${{ secrets.DISCORD_AVATAR_YTN }}
        uses: Ilshidur/action-discord@master
        with:
          args: "`YTN - YouTube`'\n'**${{steps.prepare.outputs.escaped_title}}**'\n'${{on.youtube.outputs.link}}'\n\n'ðŸ“… ${{on.youtube.outputs.pubDate}}"
